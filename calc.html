<html>
<head>
    <meta charset="utf-8">
    <title>Factorio Calculator</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="calc.css">
    <link rel="stylesheet" type="text/css" href="dropdown.css">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66808523-1', 'auto');
  ga('send', 'pageview');

</script>
    <script src="third_party/BigInteger.min.js"></script>
    <script src="third_party/d3.min.js"></script>
    <script src="third_party/dagre.min.js"></script>
    <!--<script src="third_party/graphvizlib/index.min.js"></script>
    <script src="third_party/d3-graphviz.js"></script>-->
    <script src="third_party/pako.min.js"></script>
    <script src="third_party/popper.min.js"></script>
    <script>
        var handlers = {}
    </script>
    <script type="module">
        import { plusHandler, clickTab, clickVisualize, changeTitle, changeRatePrecision, changeCountPrecision, changeFormat, changeMprod, changeVisType, changeVisRender, toggleDebug } from "./events.js"
        import { init } from "./init.js"
        handlers.plusHandler = plusHandler
        handlers.clickTab = clickTab
        handlers.clickVisualize = clickVisualize
        handlers.changeTitle = changeTitle
        handlers.changeRatePrecision = changeRatePrecision
        handlers.changeCountPrecision = changeCountPrecision
        handlers.changeFormat = changeFormat
        handlers.changeMprod = changeMprod
        handlers.changeVisType = changeVisType
        handlers.changeVisRender = changeVisRender
        handlers.toggleDebug = toggleDebug
        handlers.init = init
    </script>
</head>

<!--Copyright 2015-2024 Kirk McDonald

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.-->

<body onload="handlers.init()">
    <ul id="targets">
        <li id="plusButton">
            <button class="targetButton ui" title="Add new item."
                    onclick="handlers.plusHandler()">+</button>
        </li>
    </ul>

    <div class="tabs">
        <button class="tab_button" id="totals_button" onclick="handlers.clickTab('totals')">Factory</button>
        <button class="tab_button" id="graph_button" onclick="handlers.clickVisualize()">Visualize</button>
        <!--<button class="tab_button" id="recipes_button" onclick="handlers.clickTab('recipes')">Alt-Recipes</button>-->
        <!--<button class="tab_button" id="miners_button" onclick="handlers.clickTab('miners')">Miners</button>-->
        <button class="tab_button" id="resources_button" onclick="handlers.clickTab('resources')">Resources</button>
        <button class="tab_button" id="settings_button" onclick="handlers.clickTab('settings')">Settings</button>
        <button class="tab_button" id="about_button" onclick="handlers.clickTab('about')">About</button>
        <button class="tab_button" id="debug_button" onclick="handlers.clickTab('debug')">Debug</button>
    </div>

    <div id="graph_tab" class="tab graph">
        <div class="graph_setting">
            <form id="graph_type">
                <input id="sankey_type" type="radio" name="type" value="sankey" checked autocomplete="off" onchange="handlers.changeVisType(event)">
                <label for="sankey_type">
                    <svg viewBox="0 0 64 64" width="64" height="64">
                        <use href="images/icons.svg#sankey"></use>
                    </svg>
                </label>

                <input id="boxline_type" type="radio" name="type" value="boxline" autocomplete="off" onchange="handlers.changeVisType(event)">
                <label for="boxline_type">
                    <svg viewBox="0 0 64 64" width="64" height="64">
                        <use href="images/icons.svg#boxline"></use>
                    </svg>
                </label>
            </form>
        </div>
        <div class="graph_setting">
            Render mode:<br>
            <form id="graph_render">
                <input id="zoom_render" type="radio" name="render" value="zoom" checked autocomplete="off" onchange="handlers.changeVisRender(event)">
                <label for="zoom_render">Zoom &amp; pan</label>

                <input id="fix_render" type="radio" name="render" value="fix" autocomplete="off" onchange="handlers.changeVisRender(event)">
                <label for="fix_render">Fixed</label>
            </form>
        </div>
        <div id="graph_container">
        <svg id="graph"><g /></svg>
        </div>
    </div>

    <div id="totals_tab" class="tab">
        <table id="totals">
        <thead><tr></tr></thead>
        <tbody></tbody>
        <tfoot>
            <tr class="power-row">
                <td class="surplus"></td>
                <td class="right-align power-label"><b>total power: </b></td>
                <td class="right-align pad"><tt></tt></td>
                <td></td>
            </tr>
        </tfoot>
        </table>
    </div>

    <div id="settings_tab" class="tab">
        <table id="settings">
        <tr class="setting-section">
        <td colspan="2"><span>Data</span><hr></td>
        </tr>

            <tr class="setting-row">
            <td class="setting-label">Use recipe set:</td>
            <td><select id="data_set"></select></td>
            </tr>

        <tr class="setting-section">
        <td colspan="2"><span>Display</span><hr></td>
        </tr>

            <tr class="setting-row">
            <td class="setting-label">Title:</td>
            <td><input id="title_setting" type="text" size="30" placeholder="Factorio Calculator" oninput="handlers.changeTitle(event)"></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label top">Display rates as:</td>
            <td><form id="display_rate"></form></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label">Rate precision:</td>
            <td><input id="rprec" class="prec" type="number" value="3" min="0" onchange="handlers.changeRatePrecision(event)"></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label">Count precision:</td>
            <td><input id="cprec" class="prec" type="number" value="1" min="0" onchange="handlers.changeCountPrecision(event)"></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label top">Format values as:</td>
            <td><form id="value_format">
                <input id="decimal_format" type="radio" name="format" value="decimal" checked onchange="handlers.changeFormat(event)"><label for="decimal_format">Decimals</label><br />
                <input id="rational_format" type="radio" name="format" value="rational" onchange="handlers.changeFormat(event)"><label for="rational_format">Rationals</label><br />
            </form></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label">Color scheme:</td>
            <td><select id="color_scheme"></select></td>
            </tr>

        <tr class="setting-section">
        <td colspan="2"><span>Factory</span><hr></td>
        </tr>

            <tr class="setting-row">
            <td class="setting-label">Belt:</td>
            <td><span id="belt_selector" class="radio-setting"></span></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label">Perferred fuel:</td>
            <td><span id="fuel_selector" class="radio-setting"></span></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label">Default module:</td>
            <td><span id="default_module"></span></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label">Secondary default module:</td>
            <td><span id="secondary_module"></span></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label">Default beacon:</td>
            <td><span id="default_beacon" class="beacon-container"></span>
            &times;
            <input id="default_beacon_count" type="text" size="3">
            </td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label top-icon"><div><span>Buildings:</span></div></td>
            <td><span id="building_selector"></span></td>
            </tr>

            <tr class="setting-row">
            <td class="setting-label">Mining productivity bonus:</td>
            <td>+<input id="mprod" class="mprod" type="number" step="10" value="0" min="0" onchange="handlers.changeMprod(event)">%</td>
            </tr>

        <tr class="setting-section">
        <td colspan="2"><span>Recipes</span><hr></td>
        </tr>

            <tr class="setting-row">
            <td class="setting-label top-icon"><div><span>Toggle recipes:</span></div></td>
            <td><div id="recipe_toggles"></div></td>
            </tr>

        </table>
    </div>

    <!--<div id="recipes_tab" class="tab">
        <p>Click to toggle recipe.</p>
    </div>-->

    <div id="resources_tab" class="tab">
        <p>Click and drag items to configure resource priority.<br />
        Higher numbers = more valuable</p>
        <div id="resource_settings"></div>
    </div>

    <!--<div id="miners_tab" class="tab">
        <div id="miner_settings"></div>
    </div>-->

    <div id="about_tab" class="tab">
    <div class = "about-content">
        This calculator is copyright 2015-2024 Kirk McDonald. It is licensed under the Apache License 2.0, and its source may be <a href="https://github.com/KirkMcDonald/kirkmcdonald.github.io">found on github, here</a>.
        <p>
        This calculator is the result of a few years' worth of fooling around, off and on, with performing calculations using Factorio's recipe graph. You may find an essay on the subject, which outlines the techniques used in this calculator, <a href="http://kirkmcdonald.github.io/posts/calculation.html">here</a>.
        <p>
        Features of this calculator include:
        <ul><li>Proper handling of oil products. Obtaining numbers for these recipes can be tricky, as several of the items involved may be produced from multiple recipes.
        <li>Support for modules, including beacons.
        <li>Support for the mining productivity bonus, introduced in 0.15.
        <li>Support for "expensive" mode.
        <li>Arbitrary numerical precision. Calculations are performed using bigint rationals, so errors from floating-point calculations should not be an issue.
        <li>Support for multiple simultaneous outputs.
        <li>May display rates per second, minute, or hour.</ul>
    </div>
    </div>

    <div id="debug_tab" class="tab">
        <div id="debug_message"></div>

        <label for="render_debug">Render debug tab:</label>
        <input type="checkbox" id="render_debug" onchange="handlers.toggleDebug(event)"><br>
        Last tableau:
        <div id="debug_tableau"></div>
        Last solution:
        <div id="debug_solution"></div>
    </div>

    <div id="footer"><a href="https://github.com/KirkMcDonald/kirkmcdonald.github.io">GitHub</a> | <a href="https://discord.gg/yxrBKCP">Discord</a> | <a href="https://www.patreon.com/kirkmcdonald">Patreon</a></div>

    <div id="tooltip_container"></div>
</body>
</html>
